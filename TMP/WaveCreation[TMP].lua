---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Bergi.
--- DateTime: 14.02.2021 23:57
---

function currentHandle()
    local u = CreateUnit(Player(0), FourCC("Hpal"), 0, 0, 0)
    print(GetHandleId(u))
    RemoveUnit(u)
end
do
    TimerStart(CreateTimer(), 1, false, function()
        TempEnemyID={FourCC("nsko"),FourCC("nsog"),FourCC("nsoc")}
        effPenta="Hive\\Magic CirclePentagram\\Magic CirclePentagram Fire\\MagicCircle_Fire.mdl"
        --print("start")
        LiveOnWave={}
        --StartWave(1,10)
        local m=0
        TimerStart(CreateTimer(), 1, true, function()
            m=m+1
            --print(m)
            --currentHandle()
        end)
    end)
end

function CreateCreepDelay(id,x,y,delay,k)
    local eff=AddSpecialEffect(effPenta,x,y)
    TimerStart(CreateTimer(),delay, false, function()
        --print("create new")
        local new=CreateUnit(Player(10),id,x,y,GetRandomInt(0,360))
        IssueTargetOrder(new,"attack",HERO[0].UnitHero)
        DestroyEffect(eff)
        TimerStart(CreateTimer(),delay, true, function()
            if not UnitAlive(new) then
                DestroyTimer(GetExpiredTimer())
                LiveOnWave[k]=LiveOnWave[k]-1
                --print(LiveOnWave[k])
            end
        end)
    end)
end

function StartWave(rect,listID,max)
   -- print("start wave "..max)
    LiveOnWave[k]=max
    --print(0)
    for i = 0, max do
        --print(1)
        local loc=GetRandomLocInRect(rect)
        --print(2)
        local x,y=GetLocationX(loc),GetLocationY(loc)
        --print(i)
        CreateCreepDelay(TempEnemyID[k],x,y,1.5,k)
    end
    TimerStart(CreateTimer(),1, true, function()
        if LiveOnWave[k]<0 then
            --print("все убиты, стартуем новую волну")
            DestroyTimer(GetExpiredTimer())
            if k==#TempEnemyID then
                --print("restart "..k)
                k=0
            end
            StartWave(k+1,10)
        end
    end)
end