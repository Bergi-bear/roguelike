---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Bergi.
--- DateTime: 03.04.2021 14:30
---
function SummonLizard(data)
    if data.SummonLizardCDFH then
        if data.SummonLizardCurrentCD <= 0 then
            local cd = data.SummonLizardCD
            data.SummonLizardCurrentCD = cd
            StartFrameCD(cd, data.SummonLizardCDFH)
            CreateLizard2Point(data)
            TimerStart(CreateTimer(), cd, false, function()
                data.SummonLizardCurrentCD = 0
                DestroyTimer(GetExpiredTimer())
            end)
        end
    end
end

function SummonWinterWolf(data)
    if data.SummonWinterWolfCDFH then
        if data.SummonWinterWolfCurrentCD <= 0 then
            local cd = data.SummonWinterWolfCD
            data.SummonWinterWolfCurrentCD = cd
            StartFrameCD(cd, data.SummonWinterWolfCDFH)
            CreateWinter(data)
            TimerStart(CreateTimer(), cd, false, function()
                data.SummonWinterWolfCurrentCD = 0
                DestroyTimer(GetExpiredTimer())
            end)
        end
    end
end

function SummonBoar(data)
    if data.SummonBoarCDFH then
        if data.SummonBoarCurrentCD <= 0 then
            local cd = data.SummonBoarCD
            data.SummonBoarCurrentCD = cd
            StartFrameCD(cd, data.SummonBoarCDFH)
            --print("призываем кабана")
            local boar = CreateUnit(Player(data.pid), FourCC("nqb3"), GetUnitX(data.UnitHero), GetUnitY(data.UnitHero), GetUnitFacing(data.UnitHero))
            AddMaxLife(boar,data.HPForSummon)
            local eff = AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl", GetUnitXY(boar))
            BlzSetSpecialEffectScale(eff, 2)
            DestroyEffect(eff)
            BlzSetUnitBaseDamage(boar, 30 + GetHeroLevel(data.UnitHero) * 2, 0)
            UnitApplyTimedLife(boar, FourCC('BTLF'), 50)

            TimerStart(CreateTimer(), 1, true, function()
                if not UnitAlive(boar) then
                    DestroyTimer(GetExpiredTimer())
                else
                    if not IsUnitInRange(boar, data.UnitHero, 300) then
                        IssuePointOrder(boar, "attack", GetUnitXY(data.UnitHero))
                    end
                end
            end)

            TimerStart(CreateTimer(), cd, false, function()
                data.SummonBoarCurrentCD = 0
                DestroyTimer(GetExpiredTimer())
            end)
        end
    end
end

function SummonBear(data)
    if data.SummonBearCDFH then
        if data.SummonBearCurrentCD <= 0 then
            local cd = data.SummonBearCD
            data.SummonBearCurrentCD = cd
            StartFrameCD(cd, data.SummonBearCDFH)
            --print("падает медведь")
            FallBear2Point(data)
            TimerStart(CreateTimer(), cd, false, function()
                data.SummonBearCurrentCD = 0
                DestroyTimer(GetExpiredTimer())
            end)
        end
    end
end

function CreateLizard2Point(data)
    local xs, ys = GetUnitXY(data.UnitHero)
    local x, y = data.fakeX, data.fakeY
    local angle = AngleBetweenXY(xs, ys, x, y) / bj_DEGTORAD
    local lizard = CreateUnit(Player(data.pid), FourCC("nltl"), xs, ys, angle)-- Units\Creeps\LightningLizard\LightningLizard
    local eff = AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl", GetUnitXY(lizard))
    BlzSetSpecialEffectScale(eff, 2)
    DestroyEffect(eff)
    UnitAddAbility(lizard, FourCC("Aloc"))
    SetUnitPositionSmooth(lizard, xs, ys)
    UnitApplyTimedLife(lizard, FourCC('BTLF'), 2)
    BlzPauseUnitEx(lizard, true)

    SetUnitAnimationByIndex(lizard, 4)

    UnitAddForceSimple(lizard, angle, 10, 2000, "lizard")
end

function CreateWinter(data)
    --Abilities\Spells\Human\Blizzard\BlizzardTarget.mdl
    --Abilities\Weapons\ZigguratFrostMissile\ZigguratFrostMissile.mdl
    --Abilities\Spells\Undead\FreezingBreath\FreezingBreathMissile.mdl
    --Abilities\Spells\Undead\FrostNova\FrostNovaTarget.mdl



    local x, y = GetUnitXY(data.UnitHero)

    local e = nil

    GroupEnumUnitsInRange(perebor, x, y, 500, nil)
    while true do
        e = FirstOfGroup(perebor)

        if e == nil then
            break
        end
        if UnitAlive(e) then
            DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl",GetUnitXY(e)))
            if IsUnitEnemy(e, GetOwningPlayer(data.UnitHero))  then
                StunUnit(e,10,"frise")
                local iceLock=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl",e,"origin")
                BlzSetSpecialEffectTimeScale(iceLock,0)
                TimerStart(CreateTimer(), 10, false, function()
                    DestroyEffect(iceLock)
                end)
            end
        end
        GroupRemoveUnit(perebor, e)
    end

    local wolf = CreateUnit(Player(data.pid), FourCC("nwwd"), x, y, GetUnitFacing(data.UnitHero))
    local eff = AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl", GetUnitXY(wolf))
    BlzSetSpecialEffectScale(eff, 2)
    DestroyEffect(eff)
    AddMaxLife(wolf,data.HPForSummon)
    BlzSetUnitBaseDamage(wolf, 50 + GetHeroLevel(data.UnitHero) * 10, 0)
    UnitApplyTimedLife(wolf, FourCC('BTLF'), 20)
    eff = AddSpecialEffect("SystemGeneric\\ThunderclapCasterClassic", x, y)
    DestroyEffect(eff)
    TimerStart(CreateTimer(), 2, true, function()
        if not UnitAlive(wolf) then
            DestroyTimer(GetExpiredTimer())
        else
            if not IsUnitInRange(wolf, data.UnitHero, 300) then
                IssuePointOrder(wolf, "attack", GetUnitXY(data.UnitHero))
            end
        end
    end)
end

function FallBear2Point(data)
    local x, y = data.fakeX, data.fakeY
    local bear = CreateUnit(Player(data.pid), FourCC("nmsh"), x, y, GetUnitFacing(data.UnitHero))
    AddMaxLife(bear,data.HPForSummon)
    BlzSetUnitBaseDamage(bear, 100 + GetHeroLevel(data.UnitHero) * 10, 0)
    UnitApplyTimedLife(bear, FourCC('BTLF'), 30)
    local eff = AddSpecialEffect("SystemGeneric\\ThunderclapCasterClassic", x, y)
    DestroyEffect(eff)
    UnitDamageArea(data.UnitHero, 1000, x, y, 300)
    TimerStart(CreateTimer(), 2, true, function()
        if not UnitAlive(bear) then
            DestroyTimer(GetExpiredTimer())
        else
            if not IsUnitInRange(bear, data.UnitHero, 300) then
                IssuePointOrder(bear, "attack", GetUnitXY(data.UnitHero))
            end
        end
    end)
end