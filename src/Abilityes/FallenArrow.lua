---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Bergi.
--- DateTime: 07.05.2021 20:47
---
function FallenArrow(data, x, y)
    --local hero=data.UnitHero
    local effModel = "Abilities\\Weapons\\BallistaMissile\\BallistaMissile.mdl"
    for i = 1, 10 do
        local nx, ny = MoveXY(x, y, GetRandomInt(0, 200), GetRandomInt(0, 360))
        CreateFallArrow(effModel, data, nx, ny, GetTerrainZ(nx, ny) + GetRandomInt(900, 1000))
    end

end

function CreateFallArrow(effModel, data, x, y, zs)
    local eff = AddSpecialEffect(effModel, x, y)
    local damage=100 -- урон с навесной стрелы
    local bonus=0
    BlzSetSpecialEffectZ(eff, zs)
    BlzSetSpecialEffectPitch(eff, math.rad(90))
    TimerStart(CreateTimer(), TIMER_PERIOD64, true, function()
        local z = BlzGetLocalSpecialEffectZ(eff) - 20
        BlzSetSpecialEffectZ(eff, z)
        if z <= GetTerrainZ(x, y) then
            local flag = nil
            if data.DashAndDamageQ then
                flag = "ForceTotem"
                bonus=data.DamageSplash
            end
            if UnitDamageArea(data.UnitHero, damage+bonus, x, y, 120,flag) then
                DestroyEffect(eff)
                -- попадание навесной стрелой
                ConditionCastLight(data)
                BlzSetSpecialEffectPosition(eff, OutPoint, OutPoint, 0)
            else
                BlzSetSpecialEffectTimeScale(eff, 0)

                TimerStart(CreateTimer(), GetRandomInt(1, 60), false, function()
                    DestroyEffect(eff)
                    BlzSetSpecialEffectPosition(eff, OutPoint, OutPoint, 0)
                end)
            end
            DestroyTimer(GetExpiredTimer())

        end
    end)
end