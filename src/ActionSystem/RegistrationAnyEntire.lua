---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Bergi.
--- DateTime: 27.02.2021 18:12
---
---
do
    local InitGlobalsOrigin = InitGlobals
    function InitGlobals()
        InitGlobalsOrigin()
        TimerStart(CreateTimer(), 2, false, function()
            RegistrationAnyEntire()
        end)
    end
end

function RegistrationAnyEntire()
    for i = 0, bj_MAX_PLAYER_SLOTS - 1 do
        if IsPlayerSlotState(Player(i), PLAYER_SLOT_STATE_PLAYING) and GetPlayerController(Player(i))==MAP_CONTROL_USER then
            local data=HERO[i]
            local hero=data.UnitHero
            local enterTrig=CreateTrigger()
            TriggerRegisterUnitInRange(enterTrig,hero,200,nil)
            TriggerAddAction(enterTrig,function()
                local entering=GetTriggerUnit()
                if GetUnitTypeId(entering)==FourCC('hdhw') then

                    local dataPoint=EnterPointTable[GetHandleId(entering)]
                    --print("подошел к "..dataPoint.UseAction)
                    if dataPoint.isActive then
                        data.UseAction = dataPoint.UseAction
                        data.EPointUnit = entering
                        BlzFrameSetVisible(dataPoint.tooltip,GetLocalPlayer()==GetOwningPlayer(hero))
                        TimerStart(CreateTimer(), 0.1, true, function()
                            if not IsUnitInRange(entering,hero,210) or not UnitAlive(entering) then
                                BlzFrameSetVisible(dataPoint.tooltip,false)
                                DestroyTimer(GetExpiredTimer())
                                data.UseAction=""
                            end
                        end)
                    end
                end
            end)
        end
    end
end